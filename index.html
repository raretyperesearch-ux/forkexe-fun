<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="DexBan">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <title>DexBan - AI Launchpad</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='200' height='200' fill='black' rx='20'/%3E%3Cg fill='white'%3E%3Ctext x='100' y='85' font-family='Arial Black, sans-serif' font-size='55' font-weight='900' text-anchor='middle'%3EDEX%3C/text%3E%3Ctext x='100' y='145' font-family='Arial Black, sans-serif' font-size='55' font-weight='900' text-anchor='middle'%3EBAN%3C/text%3E%3Crect x='40' y='155' width='120' height='6' rx='3'/%3E%3C/g%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .glow-green { box-shadow: 0 0 40px rgba(34, 197, 94, 0.3); }
    .step { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
    .step.active { background: linear-gradient(135deg, #22c55e, #10b981); color: black; }
    .step.completed { background: #22c55e; color: black; }
    .step.inactive { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.4); }
    .step-line { flex: 1; height: 2px; background: rgba(255,255,255,0.1); }
    .step-line.completed { background: #22c55e; }
    .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; }
    .btn-primary { background: linear-gradient(135deg, #22c55e, #10b981); color: black; font-weight: 600; }
    .btn-primary:hover { opacity: 0.9; }
    .btn-secondary { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); }
    .btn-secondary:hover { background: rgba(255,255,255,0.15); }
    .input-field { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); }
    .input-field:focus { border-color: rgba(34, 197, 94, 0.5); outline: none; }
    .style-btn { transition: all 0.2s; }
    .style-btn.selected { border-color: #22c55e; color: #22c55e; }
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #10b981); border-radius: 3px; }
    input[type="range"] { -webkit-appearance: none; background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #22c55e; border-radius: 50%; cursor: pointer; }
  </style>
</head>
<body class="min-h-screen bg-black text-white">
  
  <!-- Header -->
  <header class="border-b border-white/10 px-6 py-4">
    <div class="flex items-center justify-between max-w-5xl mx-auto">
      <a href="https://x.com/usedexban" target="_blank" class="text-white/50 hover:text-white transition">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </a>
      <svg width="60" height="60" viewBox="0 0 200 200">
        <rect width="200" height="200" fill="black" rx="20"/>
        <g fill="white">
          <text x="100" y="85" font-family="Arial Black, sans-serif" font-size="55" font-weight="900" text-anchor="middle" letter-spacing="-3">DEX</text>
          <text x="100" y="145" font-family="Arial Black, sans-serif" font-size="55" font-weight="900" text-anchor="middle" letter-spacing="-3">BAN</text>
          <rect x="40" y="155" width="120" height="6" rx="3"/>
        </g>
      </svg>
      <div class="w-5"></div>
    </div>
  </header>

  <!-- Tabs -->
  <div class="flex justify-center gap-2 py-4 px-4 border-b border-white/5">
    <button id="tab-launchpad" class="px-6 py-2 rounded-full bg-white text-black font-semibold text-sm transition">Launchpad</button>
    <button id="tab-banner" class="px-6 py-2 rounded-full bg-white/10 text-white font-semibold text-sm hover:bg-white/20 transition">Banner</button>
    <button id="tab-dashboard" class="px-6 py-2 rounded-full bg-white/10 text-white font-semibold text-sm hover:bg-white/20 transition">Dashboard</button>
  </div>

  <main class="max-w-5xl mx-auto p-6">

    <!-- ==================== LAUNCHPAD ==================== -->
    <div id="section-launchpad">
      
      <!-- Hero -->
      <div class="text-center mb-10">
        <h1 class="text-4xl font-bold mb-4">Launch Your Token</h1>
        <p class="text-white/50 text-lg mb-6">One-click deploy to pump.fun. You keep 80% of creator fees.</p>
        <div class="inline-block px-6 py-3 bg-white/5 rounded-xl border border-white/10">
          <span class="text-white/70 text-sm">Volume → Fees → Ads → More Volume → More Fees → More Ads</span>
        </div>
      </div>

      <!-- Steps indicator -->
      <div class="flex items-center justify-center gap-3 mb-10 max-w-sm mx-auto">
        <div class="step active" id="s1">1</div>
        <div class="step-line" id="l1"></div>
        <div class="step inactive" id="s2">2</div>
        <div class="step-line" id="l2"></div>
        <div class="step inactive" id="s3">3</div>
      </div>

      <!-- Step 1: Create -->
      <div id="step1" class="max-w-xl mx-auto">
        <div class="card p-6">
          <h2 class="text-xl font-bold mb-6 text-center">Create Your Token</h2>
          
          <!-- Upload -->
          <div class="mb-6">
            <label class="text-sm text-white/50 block mb-2">Image (optional)</label>
            <label class="block cursor-pointer">
              <div id="upload-zone" class="border border-dashed border-white/20 rounded-xl p-10 text-center hover:border-white/40 transition">
                <div id="upload-prompt">
                  <div class="text-white/40 text-sm">Drop an image or click to upload</div>
                </div>
                <img id="upload-preview" class="hidden max-h-32 mx-auto rounded-xl">
              </div>
              <input type="file" id="file-input" accept="image/*" class="hidden">
            </label>
          </div>

          <!-- Description -->
          <div class="mb-6">
            <label class="text-sm text-white/50 block mb-2">Description</label>
            <textarea id="idea-input" rows="3" class="w-full px-4 py-3 input-field rounded-xl text-sm resize-none placeholder-white/30" placeholder="Describe your token idea..."></textarea>
          </div>

          <!-- Style -->
          <div class="mb-6">
            <label class="text-sm text-white/50 block mb-3">Style</label>
            <div class="grid grid-cols-4 gap-2" id="style-grid">
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-green-500 text-green-500 selected" data-style="anime, vibrant colors, dynamic">Anime</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="cyberpunk, neon, futuristic">Cyber</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="pixel art, retro 16-bit">Pixel</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="realistic, cinematic, detailed">Real</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="meme, chaotic, crypto degen">Degen</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="luxury, gold, elegant premium">Luxury</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="cosmic, space, galaxies nebula">Cosmic</button>
              <button class="style-btn px-3 py-2 rounded-lg text-xs border border-white/20 text-white/60 hover:border-white/40" data-style="cartoon, bold outlines, fun">Toon</button>
            </div>
          </div>

          <button id="generate-btn" class="w-full py-4 btn-primary rounded-xl text-lg transition">
            Generate Assets
          </button>
        </div>
      </div>

      <!-- Step 2: Preview -->
      <div id="step2" class="hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Info -->
          <div class="card p-6">
            <h3 class="text-sm font-medium text-white/50 mb-4">Token Info</h3>
            <div class="space-y-4">
              <div>
                <label class="text-xs text-white/40 block mb-1">Name</label>
                <input type="text" id="token-name" class="w-full px-4 py-3 input-field rounded-xl font-bold text-lg">
              </div>
              <div>
                <label class="text-xs text-white/40 block mb-1">Ticker</label>
                <input type="text" id="token-ticker" class="w-full px-4 py-3 input-field rounded-xl font-bold">
              </div>
              <div>
                <label class="text-xs text-white/40 block mb-1">Description</label>
                <textarea id="token-desc" rows="2" class="w-full px-4 py-3 input-field rounded-xl text-sm resize-none"></textarea>
              </div>
            </div>
          </div>

          <!-- PFP -->
          <div class="card p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm font-medium text-white/50">PFP (400x400)</h3>
              <button id="regen-pfp" class="text-xs text-white/40 hover:text-white transition">Regenerate</button>
            </div>
            <div class="aspect-square bg-black rounded-xl overflow-hidden">
              <canvas id="pfp-canvas" width="400" height="400" class="w-full h-full"></canvas>
            </div>
          </div>
        </div>

        <!-- Banner -->
        <div class="card p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-sm font-medium text-white/50">Banner (1500x500)</h3>
            <button id="regen-banner" class="text-xs text-white/40 hover:text-white transition">Regenerate</button>
          </div>
          <div class="rounded-xl overflow-hidden bg-black">
            <canvas id="banner-canvas" width="1500" height="500" class="w-full"></canvas>
          </div>
        </div>

        <!-- Nav -->
        <div class="flex gap-4 max-w-xl mx-auto">
          <button id="back-to-1" class="flex-1 py-3 btn-secondary rounded-xl font-medium transition">Back</button>
          <button id="to-step-3" class="flex-1 py-4 btn-primary rounded-xl font-bold transition">Continue</button>
        </div>
      </div>

      <!-- Step 3: Launch -->
      <div id="step3" class="hidden max-w-xl mx-auto">
        <div class="card glow-green p-6 mb-6">
          <h2 class="text-xl font-bold mb-6 text-center">Ready to Launch</h2>

          <!-- Wallet -->
          <div class="p-4 bg-black/30 rounded-xl mb-6">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xs text-white/40 mb-1">Wallet</div>
                <div id="wallet-display" class="font-mono text-sm">Not connected</div>
              </div>
              <button id="connect-btn" class="px-5 py-2 bg-purple-600 hover:bg-purple-700 rounded-xl font-medium text-sm transition">Connect Phantom</button>
            </div>
          </div>

          <!-- SOL Amount -->
          <div class="mb-6">
            <label class="text-sm text-white/50 block mb-3">Initial Buy (SOL)</label>
            <div class="flex gap-2 mb-3">
              <button class="sol-btn flex-1 py-3 rounded-xl text-sm border border-white/20 text-white/60 hover:border-white/40 transition" data-sol="0">0</button>
              <button class="sol-btn flex-1 py-3 rounded-xl text-sm border border-white/20 text-white/60 hover:border-white/40 transition" data-sol="0.5">0.5</button>
              <button class="sol-btn flex-1 py-3 rounded-xl text-sm border border-green-500 text-green-500" data-sol="1">1</button>
              <button class="sol-btn flex-1 py-3 rounded-xl text-sm border border-white/20 text-white/60 hover:border-white/40 transition" data-sol="2">2</button>
              <button class="sol-btn flex-1 py-3 rounded-xl text-sm border border-white/20 text-white/60 hover:border-white/40 transition" data-sol="5">5</button>
            </div>
            <div class="flex items-center gap-3">
              <input type="range" id="sol-slider" min="0" max="5" step="0.1" value="1" class="flex-1">
              <span id="sol-slider-value" class="text-sm font-mono w-16 text-right">1 SOL</span>
            </div>
          </div>

          <!-- Fee info -->
          <div class="p-4 bg-black/30 rounded-xl mb-6">
            <div class="text-xs text-white/40 mb-3">Fee Split</div>
            <div class="space-y-3">
              <div>
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-green-400">You — 80%</span>
                  <span class="text-white/40">Creator fees forever</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" style="width:80%"></div></div>
              </div>
              <div>
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-white/60">DexBan — 20%</span>
                  <span class="text-white/40">DexScreener + Ads</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" style="width:20%;opacity:0.5"></div></div>
              </div>
            </div>
          </div>

          <!-- Summary -->
          <div class="p-4 bg-black/30 rounded-xl mb-6">
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div><span class="text-white/40">Token:</span> <span id="sum-name" class="font-bold">-</span></div>
              <div><span class="text-white/40">Ticker:</span> <span id="sum-ticker" class="font-bold">-</span></div>
              <div><span class="text-white/40">Initial Buy:</span> <span id="sum-buy" class="font-bold">1 SOL</span></div>
              <div><span class="text-white/40">Cost:</span> <span class="font-bold text-green-400">Free</span></div>
            </div>
          </div>

          <button id="launch-btn" class="w-full py-4 btn-primary rounded-xl font-bold text-lg transition disabled:opacity-40 disabled:cursor-not-allowed" disabled>
            Launch Token
          </button>
          <p class="text-center text-white/30 text-xs mt-3">By launching you agree to the 80/20 fee split</p>
        </div>

        <button id="back-to-2" class="w-full py-3 btn-secondary rounded-xl font-medium transition">Back</button>
      </div>

      <!-- Loading -->
      <div id="loading" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center z-50">
        <div class="text-center">
          <div class="w-10 h-10 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <div id="loading-text" class="text-lg font-medium mb-1">Generating...</div>
          <div id="loading-sub" class="text-white/50 text-sm"></div>
        </div>
      </div>
    </div>

    <!-- ==================== BANNER GENERATOR ==================== -->
    <div id="section-banner" class="hidden">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold mb-2">Banner Generator</h1>
        <p class="text-white/50">Create banners for existing tokens</p>
      </div>

      <div class="card p-6 mb-6">
        <div class="rounded-xl overflow-hidden bg-black">
          <canvas id="gen-canvas" width="1500" height="500" class="w-full"></canvas>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div class="card p-4">
            <label class="text-sm text-white/50 block mb-2">Reference Image</label>
            <label class="block cursor-pointer">
              <div id="gen-upload-zone" class="border border-dashed border-white/20 rounded-xl p-6 text-center hover:border-white/40 transition">
                <div id="gen-upload-prompt" class="text-white/40 text-sm">Drop image or click to upload</div>
                <img id="gen-upload-preview" class="hidden max-h-24 mx-auto rounded-lg">
              </div>
              <input type="file" id="gen-file-input" accept="image/*" class="hidden">
            </label>
          </div>

          <div class="card p-4">
            <label class="text-sm text-white/50 block mb-2">Prompt</label>
            <textarea id="gen-prompt" rows="3" class="w-full px-4 py-3 input-field rounded-xl text-sm resize-none placeholder-white/30" placeholder="Describe your banner..."></textarea>
          </div>

          <button id="gen-btn" class="w-full py-3 btn-primary rounded-xl font-medium transition">Generate</button>
        </div>

        <div class="card p-4 space-y-4">
          <div class="flex items-center justify-between">
            <span class="text-sm text-white/50">Text Overlay</span>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" id="gen-show-text" checked class="rounded border-white/30">
              <span class="text-xs text-white/40">Enabled</span>
            </label>
          </div>
          <input type="text" id="gen-token-name" placeholder="Token Name" class="w-full px-4 py-3 input-field rounded-xl text-sm">
          <input type="text" id="gen-tagline" placeholder="Tagline" class="w-full px-4 py-3 input-field rounded-xl text-sm">
          <div>
            <label class="text-xs text-white/40 block mb-1">Size</label>
            <input type="range" id="gen-font-size" min="40" max="200" value="120" class="w-full">
          </div>
          <div>
            <label class="text-xs text-white/40 block mb-1">Position</label>
            <input type="range" id="gen-text-y" min="10" max="90" value="50" class="w-full">
          </div>
          <div class="flex gap-3 pt-2">
            <button id="gen-download" class="flex-1 py-3 btn-secondary rounded-xl text-sm font-medium transition">Download</button>
            <button id="gen-share" class="flex-1 py-3 btn-primary rounded-xl text-sm font-medium transition">Share</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== DASHBOARD ==================== -->
    <div id="section-dashboard" class="hidden">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold mb-2">Dashboard</h1>
        <p class="text-white/50">Track your launched tokens</p>
      </div>

      <div id="no-tokens" class="card p-12 text-center">
        <div class="text-white/40 mb-4">No tokens yet</div>
        <button onclick="switchTab('launchpad')" class="px-6 py-3 btn-primary rounded-xl font-medium transition">Launch Your First Token</button>
      </div>

      <div id="token-cards" class="hidden space-y-4"></div>
    </div>

  </main>

  <footer class="border-t border-white/10 py-6 mt-12 text-center">
    <p class="text-white/40 text-sm">Built by <a href="https://x.com/istudycharts" target="_blank" class="text-white hover:underline">@istudycharts</a></p>
  </footer>


  <script>
    // State
    const DEXBAN_WALLET = 'EZ9KL8uy7GW5b5S7mMp4VQyGTK9tkrVBDjLn8iyWB7z8';
    let uploadedImage = null, uploadedMime = null;
    let generatedPFP = null, generatedBanner = null;
    let selectedStyle = 'anime, vibrant colors, dynamic';
    let connectedWallet = null;
    let initialBuy = 1;

    const pfpCanvas = document.getElementById('pfp-canvas');
    const pfpCtx = pfpCanvas.getContext('2d');
    const bannerCanvas = document.getElementById('banner-canvas');
    const bannerCtx = bannerCanvas.getContext('2d');
    const genCanvas = document.getElementById('gen-canvas');
    const genCtx = genCanvas.getContext('2d');

    // Tab switching
    function switchTab(tab) {
      ['launchpad', 'banner', 'dashboard'].forEach(t => {
        document.getElementById('section-' + t).classList.toggle('hidden', t !== tab);
        const btn = document.getElementById('tab-' + t);
        btn.classList.toggle('bg-white', t === tab);
        btn.classList.toggle('text-black', t === tab);
        btn.classList.toggle('bg-white/10', t !== tab);
        btn.classList.toggle('text-white', t !== tab);
      });
      if (tab === 'dashboard') loadDashboard();
    }
    document.getElementById('tab-launchpad').onclick = () => switchTab('launchpad');
    document.getElementById('tab-banner').onclick = () => switchTab('banner');
    document.getElementById('tab-dashboard').onclick = () => switchTab('dashboard');

    // Step navigation
    function showStep(n) {
      [1, 2, 3].forEach(i => {
        document.getElementById('step' + i).classList.toggle('hidden', i !== n);
        const s = document.getElementById('s' + i);
        s.classList.remove('active', 'completed', 'inactive');
        s.classList.add(i < n ? 'completed' : i === n ? 'active' : 'inactive');
        if (i < 3) document.getElementById('l' + i).classList.toggle('completed', i < n);
      });
    }

    document.getElementById('back-to-1').onclick = () => showStep(1);
    document.getElementById('back-to-2').onclick = () => showStep(2);
    document.getElementById('to-step-3').onclick = () => {
      document.getElementById('sum-name').textContent = document.getElementById('token-name').value || '-';
      document.getElementById('sum-ticker').textContent = document.getElementById('token-ticker').value || '-';
      showStep(3);
    };

    // Upload
    const fileInput = document.getElementById('file-input');
    document.getElementById('upload-zone').onclick = () => fileInput.click();
    fileInput.onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          uploadedImage = ev.target.result.split(',')[1];
          uploadedMime = file.type || 'image/png';
          document.getElementById('upload-preview').src = ev.target.result;
          document.getElementById('upload-preview').classList.remove('hidden');
          document.getElementById('upload-prompt').classList.add('hidden');
        };
        reader.readAsDataURL(file);
      }
    };

    // Style selection
    document.getElementById('style-grid').onclick = (e) => {
      const btn = e.target.closest('.style-btn');
      if (btn) {
        document.querySelectorAll('.style-btn').forEach(b => {
          b.classList.remove('selected', 'border-green-500', 'text-green-500');
          b.classList.add('border-white/20', 'text-white/60');
        });
        btn.classList.add('selected', 'border-green-500', 'text-green-500');
        btn.classList.remove('border-white/20', 'text-white/60');
        selectedStyle = btn.dataset.style;
      }
    };

    // SOL buttons
    document.querySelectorAll('.sol-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.sol-btn').forEach(b => {
          b.classList.remove('border-green-500', 'text-green-500');
          b.classList.add('border-white/20', 'text-white/60');
        });
        btn.classList.add('border-green-500', 'text-green-500');
        btn.classList.remove('border-white/20', 'text-white/60');
        initialBuy = parseFloat(btn.dataset.sol);
        document.getElementById('sol-slider').value = initialBuy;
        document.getElementById('sol-slider-value').textContent = initialBuy + ' SOL';
        document.getElementById('sum-buy').textContent = initialBuy + ' SOL';
      };
    });

    // SOL slider
    document.getElementById('sol-slider').oninput = (e) => {
      initialBuy = parseFloat(e.target.value);
      document.getElementById('sol-slider-value').textContent = initialBuy.toFixed(1) + ' SOL';
      document.getElementById('sum-buy').textContent = initialBuy.toFixed(1) + ' SOL';
      // Update button states
      document.querySelectorAll('.sol-btn').forEach(b => {
        const btnVal = parseFloat(b.dataset.sol);
        if (btnVal === initialBuy) {
          b.classList.add('border-green-500', 'text-green-500');
          b.classList.remove('border-white/20', 'text-white/60');
        } else {
          b.classList.remove('border-green-500', 'text-green-500');
          b.classList.add('border-white/20', 'text-white/60');
        }
      });
    };

    // Wallet
    document.getElementById('connect-btn').onclick = async () => {
      try {
        if (!window.solana?.isPhantom) {
          window.open('https://phantom.app/', '_blank');
          return;
        }
        const resp = await window.solana.connect();
        connectedWallet = resp.publicKey.toString();
        document.getElementById('wallet-display').textContent = connectedWallet.slice(0, 4) + '...' + connectedWallet.slice(-4);
        document.getElementById('connect-btn').textContent = 'Connected';
        document.getElementById('connect-btn').classList.remove('bg-purple-600', 'hover:bg-purple-700');
        document.getElementById('connect-btn').classList.add('bg-green-600');
        document.getElementById('launch-btn').disabled = false;
      } catch (err) {
        console.error(err);
      }
    };

    // Generate
    document.getElementById('generate-btn').onclick = async () => {
      const idea = document.getElementById('idea-input').value.trim();
      if (!idea && !uploadedImage) {
        alert('Please upload an image or describe your token');
        return;
      }

      const loading = document.getElementById('loading');
      const loadingText = document.getElementById('loading-text');
      const loadingSub = document.getElementById('loading-sub');
      loading.classList.remove('hidden');

      try {
        loadingText.textContent = 'Creating token info...';
        loadingSub.textContent = '';
        
        const words = idea.toLowerCase().split(' ').filter(w => w.length > 2);
        const baseWord = words[0] || 'moon';
        const capWord = baseWord.charAt(0).toUpperCase() + baseWord.slice(1);
        
        document.getElementById('token-name').value = capWord;
        document.getElementById('token-ticker').value = '$' + baseWord.toUpperCase().slice(0, 5);
        document.getElementById('token-desc').value = idea || 'The next big memecoin.';

        loadingText.textContent = 'Generating PFP...';
        loadingSub.textContent = 'This may take a moment';

        const pfpPrompt = `Create a crypto token mascot (square). ${idea || 'Cool character'}. Style: ${selectedStyle}. Iconic, centered, memorable.`;
        
        const pfpResp = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: pfpPrompt, imageBase64: uploadedImage, imageMimeType: uploadedMime })
        });
        const pfpData = await pfpResp.json();
        if (pfpData.error) throw new Error(pfpData.error);

        generatedPFP = new Image();
        await new Promise((res, rej) => {
          generatedPFP.onload = res;
          generatedPFP.onerror = rej;
          generatedPFP.src = 'data:image/png;base64,' + pfpData.imageData;
        });
        drawPFP();

        loadingText.textContent = 'Generating banner...';

        const ticker = document.getElementById('token-ticker').value;
        const bannerPrompt = `Create a crypto banner (1500x500) for "${ticker}". Include "${ticker}" prominently styled. ${idea || 'Epic vibes'}. Style: ${selectedStyle}. Professional.`;

        const bannerResp = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: bannerPrompt, imageBase64: uploadedImage, imageMimeType: uploadedMime })
        });
        const bannerData = await bannerResp.json();
        if (bannerData.error) throw new Error(bannerData.error);

        generatedBanner = new Image();
        await new Promise((res, rej) => {
          generatedBanner.onload = res;
          generatedBanner.onerror = rej;
          generatedBanner.src = 'data:image/png;base64,' + bannerData.imageData;
        });
        drawBanner();

        loading.classList.add('hidden');
        showStep(2);
      } catch (err) {
        loading.classList.add('hidden');
        alert('Error: ' + err.message);
      }
    };

    function drawPFP() {
      pfpCtx.fillStyle = '#000';
      pfpCtx.fillRect(0, 0, 400, 400);
      if (generatedPFP) {
        const r = generatedPFP.width / generatedPFP.height;
        let w, h, x, y;
        if (r > 1) { h = 400; w = 400 * r; x = (400 - w) / 2; y = 0; }
        else { w = 400; h = 400 / r; x = 0; y = (400 - h) / 2; }
        pfpCtx.drawImage(generatedPFP, x, y, w, h);
      }
    }

    function drawBanner() {
      bannerCtx.fillStyle = '#000';
      bannerCtx.fillRect(0, 0, 1500, 500);
      if (generatedBanner) {
        const r = generatedBanner.width / generatedBanner.height;
        const cr = 3;
        let w, h, x, y;
        if (r > cr) { h = 500; w = 500 * r; x = (1500 - w) / 2; y = 0; }
        else { w = 1500; h = 1500 / r; x = 0; y = (500 - h) / 2; }
        bannerCtx.drawImage(generatedBanner, x, y, w, h);
      }
    }

    // Launch
    document.getElementById('launch-btn').onclick = async () => {
      if (!connectedWallet) return alert('Connect wallet first');

      const name = document.getElementById('token-name').value.trim();
      const ticker = document.getElementById('token-ticker').value.replace('$', '').trim();
      const desc = document.getElementById('token-desc').value.trim();
      if (!name || !ticker) return alert('Fill in name and ticker');

      const loading = document.getElementById('loading');
      const loadingText = document.getElementById('loading-text');
      const loadingSub = document.getElementById('loading-sub');
      loading.classList.remove('hidden');

      try {
        loadingText.textContent = 'Uploading to IPFS...';
        loadingSub.textContent = '';

        const pfpBlob = await new Promise(res => pfpCanvas.toBlob(res, 'image/png'));
        const formData = new FormData();
        formData.append('file', pfpBlob, 'token.png');
        formData.append('name', name);
        formData.append('symbol', ticker);
        formData.append('description', desc);
        formData.append('showName', 'true');
        formData.append('twitter', 'https://x.com/usedexban');
        formData.append('website', 'https://dexban.com');

        const ipfsResp = await fetch('https://pump.fun/api/ipfs', { method: 'POST', body: formData });
        if (!ipfsResp.ok) throw new Error('IPFS upload failed');
        const ipfsData = await ipfsResp.json();

        loadingText.textContent = 'Creating token...';

        const mintBytes = new Uint8Array(32);
        crypto.getRandomValues(mintBytes);
        const mintKey = Array.from(mintBytes).map(b => b.toString(16).padStart(2, '0')).join('');

        const createResp = await fetch('https://pumpportal.fun/api/trade-local', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            publicKey: DEXBAN_WALLET,
            action: 'create',
            tokenMetadata: { name, symbol: ticker, uri: ipfsData.metadataUri },
            mint: mintKey,
            denominatedInSol: 'true',
            amount: initialBuy,
            slippage: 15,
            priorityFee: 0.0005,
            pool: 'pump'
          })
        });
        if (!createResp.ok) throw new Error('Token creation failed');

        loadingText.textContent = 'Sign in wallet...';

        const txData = await createResp.arrayBuffer();
        const { VersionedTransaction, Connection } = await import('https://esm.sh/@solana/web3.js@1.87.6');
        const tx = VersionedTransaction.deserialize(new Uint8Array(txData));
        const signedTx = await window.solana.signTransaction(tx);

        loadingText.textContent = 'Launching...';

        const connection = new Connection('https://api.mainnet-beta.solana.com');
        const sig = await connection.sendRawTransaction(signedTx.serialize(), { skipPreflight: true });
        loadingSub.textContent = sig.slice(0, 16) + '...';
        await connection.confirmTransaction(sig, 'confirmed');

        const tokens = JSON.parse(localStorage.getItem('dexban_tokens') || '[]');
        tokens.push({
          name, ticker, desc, mint: mintKey, sig, launchDate: Date.now(),
          pfp: pfpCanvas.toDataURL(), banner: bannerCanvas.toDataURL()
        });
        localStorage.setItem('dexban_tokens', JSON.stringify(tokens));

        loading.classList.add('hidden');
        alert('Token launched!\n\nTicker: $' + ticker + '\nSignature: ' + sig);
        switchTab('dashboard');
      } catch (err) {
        loading.classList.add('hidden');
        alert('Error: ' + err.message);
      }
    };

    // Dashboard
    function loadDashboard() {
      const tokens = JSON.parse(localStorage.getItem('dexban_tokens') || '[]');
      const noTokens = document.getElementById('no-tokens');
      const cards = document.getElementById('token-cards');

      if (tokens.length === 0) {
        noTokens.classList.remove('hidden');
        cards.classList.add('hidden');
        return;
      }

      noTokens.classList.add('hidden');
      cards.classList.remove('hidden');
      cards.innerHTML = '';

      tokens.forEach(token => {
        const card = document.createElement('div');
        card.className = 'card p-6';
        card.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <img src="${token.pfp}" class="w-14 h-14 rounded-xl" alt="">
            <div class="flex-1">
              <div class="font-bold">${token.name}</div>
              <div class="text-white/50 text-sm">${token.ticker}</div>
            </div>
            <div class="text-right text-sm text-white/40">${new Date(token.launchDate).toLocaleDateString()}</div>
          </div>
          <div class="p-4 bg-black/30 rounded-xl mb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-xs text-white/40">DexScreener Progress</span>
              <span class="text-xs text-white/40">$0 / $299</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
          </div>
          <div class="flex gap-3">
            <a href="https://pump.fun/coin/${token.mint}" target="_blank" class="flex-1 py-2 btn-secondary rounded-xl text-center text-sm">pump.fun</a>
            <a href="https://dexscreener.com/solana/${token.mint}" target="_blank" class="flex-1 py-2 btn-secondary rounded-xl text-center text-sm">DexScreener</a>
          </div>
        `;
        cards.appendChild(card);
      });
    }

    // Banner generator
    let genImageBase64 = null, genImageMime = null, genGeneratedImg = null;
    const genFileInput = document.getElementById('gen-file-input');
    document.getElementById('gen-upload-zone').onclick = () => genFileInput.click();
    genFileInput.onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          genImageBase64 = ev.target.result.split(',')[1];
          genImageMime = file.type || 'image/png';
          document.getElementById('gen-upload-preview').src = ev.target.result;
          document.getElementById('gen-upload-preview').classList.remove('hidden');
          document.getElementById('gen-upload-prompt').classList.add('hidden');
        };
        reader.readAsDataURL(file);
      }
    };

    document.getElementById('gen-btn').onclick = async () => {
      const prompt = document.getElementById('gen-prompt').value.trim();
      if (!prompt) return alert('Enter a prompt');

      const btn = document.getElementById('gen-btn');
      btn.disabled = true;
      btn.textContent = 'Generating...';

      try {
        const resp = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, imageBase64: genImageBase64, imageMimeType: genImageMime })
        });
        const data = await resp.json();
        if (data.error) throw new Error(data.error);

        genGeneratedImg = new Image();
        await new Promise((res, rej) => {
          genGeneratedImg.onload = res;
          genGeneratedImg.onerror = rej;
          genGeneratedImg.src = 'data:image/png;base64,' + data.imageData;
        });
        drawGenCanvas();
      } catch (err) {
        alert('Error: ' + err.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Generate';
      }
    };

    function drawGenCanvas() {
      genCtx.fillStyle = '#000';
      genCtx.fillRect(0, 0, 1500, 500);
      if (genGeneratedImg) {
        const r = genGeneratedImg.width / genGeneratedImg.height;
        let w, h, x, y;
        if (r > 3) { h = 500; w = 500 * r; x = (1500 - w) / 2; y = 0; }
        else { w = 1500; h = 1500 / r; x = 0; y = (500 - h) / 2; }
        genCtx.drawImage(genGeneratedImg, x, y, w, h);
      }
      if (document.getElementById('gen-show-text').checked) {
        const name = document.getElementById('gen-token-name').value;
        const tag = document.getElementById('gen-tagline').value;
        const size = document.getElementById('gen-font-size').value;
        const yPos = document.getElementById('gen-text-y').value;
        if (name) {
          genCtx.font = `700 ${size}px Inter, sans-serif`;
          genCtx.textAlign = 'center';
          genCtx.fillStyle = '#fff';
          genCtx.shadowColor = '#000';
          genCtx.shadowBlur = 20;
          genCtx.fillText(name, 750, (yPos / 100) * 500);
        }
        if (tag) {
          genCtx.font = '500 40px Inter, sans-serif';
          genCtx.fillText(tag, 750, (yPos / 100) * 500 + 50);
        }
        genCtx.shadowBlur = 0;
      }
    }

    ['gen-token-name', 'gen-tagline', 'gen-font-size', 'gen-text-y', 'gen-show-text'].forEach(id => {
      document.getElementById(id).addEventListener('input', drawGenCanvas);
    });

    document.getElementById('gen-download').onclick = () => {
      const link = document.createElement('a');
      link.download = 'dexban_banner.png';
      link.href = genCanvas.toDataURL('image/png');
      link.click();
    };

    document.getElementById('gen-share').onclick = () => {
      document.getElementById('gen-download').click();
      setTimeout(() => window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent('Made with @usedexban\n\ndexban.com'), '_blank'), 500);
    };

    drawGenCanvas();
  </script>
</body>
</html>
